{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.locks = locks;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\"); // Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nconst LOCKUPS = [0, 1, 2, 4, 8, 16, 32];\n\nfunction parseEnd(api, vote, {\n  approved,\n  end\n}) {\n  return [end, approved.isTrue && vote.isAye || approved.isFalse && vote.isNay ? end.add(api.consts.democracy.enactmentPeriod.muln(LOCKUPS[vote.conviction.index])) : _util.BN_ZERO];\n}\n\nfunction parseLock(api, [referendumId, accountVote], referendum) {\n  const {\n    balance,\n    vote\n  } = accountVote.asStandard;\n  const [referendumEnd, unlockAt] = referendum.isFinished ? parseEnd(api, vote, referendum.asFinished) : [_util.BN_ZERO, _util.BN_ZERO];\n  return {\n    balance,\n    isDelegated: false,\n    isFinished: referendum.isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt,\n    vote\n  };\n}\n\nfunction delegateLocks(api, {\n  balance,\n  conviction,\n  target\n}) {\n  return api.derive.democracy.locks(target).pipe((0, _operators.map)(available => available.map(({\n    isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt,\n    vote\n  }) => ({\n    balance,\n    isDelegated: true,\n    isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt: unlockAt.isZero() ? unlockAt : referendumEnd.add(api.consts.democracy.enactmentPeriod.muln(LOCKUPS[conviction.index])),\n    vote: api.registry.createType('Vote', {\n      aye: vote.isAye,\n      conviction\n    })\n  }))));\n}\n\nfunction directLocks(api, {\n  votes\n}) {\n  if (!votes.length) {\n    return (0, _rxjs.of)([]);\n  }\n\n  return api.query.democracy.referendumInfoOf.multi(votes.map(([referendumId]) => referendumId)).pipe((0, _operators.map)(referendums => votes.map((vote, index) => [vote, referendums[index].unwrapOr(null)]).filter(item => !!item[1] && (0, _util.isUndefined)(item[1].end) && item[0][1].isStandard).map(([directVote, referendum]) => parseLock(api, directVote, referendum))));\n}\n\nfunction locks(instanceId, api) {\n  return (0, _util2.memo)(instanceId, accountId => api.query.democracy.votingOf ? api.query.democracy.votingOf(accountId).pipe((0, _operators.switchMap)(voting => voting.isDirect ? directLocks(api, voting.asDirect) : voting.isDelegating ? delegateLocks(api, voting.asDelegating) : (0, _rxjs.of)([]))) : (0, _rxjs.of)([]));\n}","map":{"version":3,"sources":["/home/tmaltus/Documents/BlockChainProjects/dotNetworkBlockInfo/node_modules/@polkadot/api-derive/democracy/locks.js"],"names":["Object","defineProperty","exports","value","locks","_rxjs","require","_operators","_util","_util2","LOCKUPS","parseEnd","api","vote","approved","end","isTrue","isAye","isFalse","isNay","add","consts","democracy","enactmentPeriod","muln","conviction","index","BN_ZERO","parseLock","referendumId","accountVote","referendum","balance","asStandard","referendumEnd","unlockAt","isFinished","asFinished","isDelegated","delegateLocks","target","derive","pipe","map","available","isZero","registry","createType","aye","directLocks","votes","length","of","query","referendumInfoOf","multi","referendums","unwrapOr","filter","item","isUndefined","isStandard","directVote","instanceId","memo","accountId","votingOf","switchMap","voting","isDirect","asDirect","isDelegating","asDelegating"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.locks = locks;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\");\n\n// Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nconst LOCKUPS = [0, 1, 2, 4, 8, 16, 32];\n\nfunction parseEnd(api, vote, {\n  approved,\n  end\n}) {\n  return [end, approved.isTrue && vote.isAye || approved.isFalse && vote.isNay ? end.add(api.consts.democracy.enactmentPeriod.muln(LOCKUPS[vote.conviction.index])) : _util.BN_ZERO];\n}\n\nfunction parseLock(api, [referendumId, accountVote], referendum) {\n  const {\n    balance,\n    vote\n  } = accountVote.asStandard;\n  const [referendumEnd, unlockAt] = referendum.isFinished ? parseEnd(api, vote, referendum.asFinished) : [_util.BN_ZERO, _util.BN_ZERO];\n  return {\n    balance,\n    isDelegated: false,\n    isFinished: referendum.isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt,\n    vote\n  };\n}\n\nfunction delegateLocks(api, {\n  balance,\n  conviction,\n  target\n}) {\n  return api.derive.democracy.locks(target).pipe((0, _operators.map)(available => available.map(({\n    isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt,\n    vote\n  }) => ({\n    balance,\n    isDelegated: true,\n    isFinished,\n    referendumEnd,\n    referendumId,\n    unlockAt: unlockAt.isZero() ? unlockAt : referendumEnd.add(api.consts.democracy.enactmentPeriod.muln(LOCKUPS[conviction.index])),\n    vote: api.registry.createType('Vote', {\n      aye: vote.isAye,\n      conviction\n    })\n  }))));\n}\n\nfunction directLocks(api, {\n  votes\n}) {\n  if (!votes.length) {\n    return (0, _rxjs.of)([]);\n  }\n\n  return api.query.democracy.referendumInfoOf.multi(votes.map(([referendumId]) => referendumId)).pipe((0, _operators.map)(referendums => votes.map((vote, index) => [vote, referendums[index].unwrapOr(null)]).filter(item => !!item[1] && (0, _util.isUndefined)(item[1].end) && item[0][1].isStandard).map(([directVote, referendum]) => parseLock(api, directVote, referendum))));\n}\n\nfunction locks(instanceId, api) {\n  return (0, _util2.memo)(instanceId, accountId => api.query.democracy.votingOf ? api.query.democracy.votingOf(accountId).pipe((0, _operators.switchMap)(voting => voting.isDirect ? directLocks(api, voting.asDirect) : voting.isDelegating ? delegateLocks(api, voting.asDelegating) : (0, _rxjs.of)([]))) : (0, _rxjs.of)([]));\n}"]},"metadata":{},"sourceType":"script"}