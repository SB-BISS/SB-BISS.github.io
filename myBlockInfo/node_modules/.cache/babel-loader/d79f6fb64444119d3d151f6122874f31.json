{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"/home/tmaltus/Documents/BlockChainProjects/dotNetworkBlockInfo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _toConsumableArray = require(\"/home/tmaltus/Documents/BlockChainProjects/dotNetworkBlockInfo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._erasPoints = _erasPoints;\nexports.erasPoints = erasPoints;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\");\n\nvar _util3 = require(\"./util\"); // Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\n\nvar CACHE_KEY = 'eraPoints';\n\nfunction mapValidators(_ref) {\n  var individual = _ref.individual;\n  return _toConsumableArray(individual.entries()).filter(function (_ref2) {\n    var _ref3 = _slicedToArray(_ref2, 2),\n        points = _ref3[1];\n\n    return points.gt(_util.BN_ZERO);\n  }).reduce(function (result, _ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        validatorId = _ref5[0],\n        points = _ref5[1];\n\n    result[validatorId.toString()] = points;\n    return result;\n  }, {});\n}\n\nfunction mapPoints(eras, points) {\n  return eras.map(function (era, index) {\n    return {\n      era: era,\n      eraPoints: points[index].total,\n      validators: mapValidators(points[index])\n    };\n  });\n}\n\nfunction _erasPoints(instanceId, api) {\n  return (0, _util2.memo)(instanceId, function (eras, withActive) {\n    if (!eras.length) {\n      return (0, _rxjs.of)([]);\n    }\n\n    var cached = withActive ? [] : eras.map(function (era) {\n      return _util2.deriveCache.get(\"\".concat(CACHE_KEY, \"-\").concat(era.toString()));\n    }).filter(function (value) {\n      return !!value;\n    });\n    var remaining = (0, _util3.filterEras)(eras, cached);\n    return !remaining.length ? (0, _rxjs.of)(cached) : api.query.staking.erasRewardPoints.multi(remaining).pipe((0, _operators.map)(function (points) {\n      var query = mapPoints(remaining, points);\n      !withActive && query.forEach(function (q) {\n        return _util2.deriveCache.set(\"\".concat(CACHE_KEY, \"-\").concat(q.era.toString()), q);\n      });\n      return eras.map(function (era) {\n        return cached.find(function (cached) {\n          return era.eq(cached.era);\n        }) || query.find(function (query) {\n          return era.eq(query.era);\n        });\n      });\n    }));\n  });\n}\n\nfunction erasPoints(instanceId, api) {\n  return (0, _util2.memo)(instanceId, function () {\n    var withActive = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    return api.derive.staking.erasHistoric(withActive).pipe((0, _operators.switchMap)(function (eras) {\n      return api.derive.staking._erasPoints(eras, withActive);\n    }));\n  });\n}","map":{"version":3,"sources":["/home/tmaltus/Documents/BlockChainProjects/dotNetworkBlockInfo/node_modules/@polkadot/api-derive/staking/erasPoints.js"],"names":["Object","defineProperty","exports","value","_erasPoints","erasPoints","_rxjs","require","_operators","_util","_util2","_util3","CACHE_KEY","mapValidators","individual","entries","filter","points","gt","BN_ZERO","reduce","result","validatorId","toString","mapPoints","eras","map","era","index","eraPoints","total","validators","instanceId","api","memo","withActive","length","of","cached","deriveCache","get","remaining","filterEras","query","staking","erasRewardPoints","multi","pipe","forEach","q","set","find","eq","derive","erasHistoric","switchMap"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports._erasPoints = _erasPoints;\nexports.erasPoints = erasPoints;\n\nvar _rxjs = require(\"rxjs\");\n\nvar _operators = require(\"rxjs/operators\");\n\nvar _util = require(\"@polkadot/util\");\n\nvar _util2 = require(\"../util\");\n\nvar _util3 = require(\"./util\");\n\n// Copyright 2017-2020 @polkadot/api-derive authors & contributors\n// SPDX-License-Identifier: Apache-2.0\nconst CACHE_KEY = 'eraPoints';\n\nfunction mapValidators({\n  individual\n}) {\n  return [...individual.entries()].filter(([, points]) => points.gt(_util.BN_ZERO)).reduce((result, [validatorId, points]) => {\n    result[validatorId.toString()] = points;\n    return result;\n  }, {});\n}\n\nfunction mapPoints(eras, points) {\n  return eras.map((era, index) => ({\n    era,\n    eraPoints: points[index].total,\n    validators: mapValidators(points[index])\n  }));\n}\n\nfunction _erasPoints(instanceId, api) {\n  return (0, _util2.memo)(instanceId, (eras, withActive) => {\n    if (!eras.length) {\n      return (0, _rxjs.of)([]);\n    }\n\n    const cached = withActive ? [] : eras.map(era => _util2.deriveCache.get(`${CACHE_KEY}-${era.toString()}`)).filter(value => !!value);\n    const remaining = (0, _util3.filterEras)(eras, cached);\n    return !remaining.length ? (0, _rxjs.of)(cached) : api.query.staking.erasRewardPoints.multi(remaining).pipe((0, _operators.map)(points => {\n      const query = mapPoints(remaining, points);\n      !withActive && query.forEach(q => _util2.deriveCache.set(`${CACHE_KEY}-${q.era.toString()}`, q));\n      return eras.map(era => cached.find(cached => era.eq(cached.era)) || query.find(query => era.eq(query.era)));\n    }));\n  });\n}\n\nfunction erasPoints(instanceId, api) {\n  return (0, _util2.memo)(instanceId, (withActive = false) => api.derive.staking.erasHistoric(withActive).pipe((0, _operators.switchMap)(eras => api.derive.staking._erasPoints(eras, withActive))));\n}"]},"metadata":{},"sourceType":"script"}